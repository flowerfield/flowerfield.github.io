<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Node系列-cnpm · 花田半亩</title><meta name="description" content="Node系列-cnpm - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/鲸鱼.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="https://github.com/flowerField" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Node系列-cnpm</h1><div class="post-info">Nov 25, 2018<span class="post-count"></span> ✧ 字数统计:1,463(字) &nbsp;&nbsp; ♨︎ 阅读时长:7(分钟)</div><div class="post-content"><p><img src="https://camo.githubusercontent.com/b674d29f60a0c9b6474843a70d305b7ab6c8da99/68747470733a2f2f7261772e6769746875622e636f6d2f636e706d2f636e706d6a732e6f72672f6d61737465722f6c6f676f2e706e67" style="width:200px"></p>
<div class="tip">本文输出Node中另一款包管理工具CNPM相关的内容，包括基本情况和简单使用。</div>

<h4 id="1-0-简单介绍"><a href="#1-0-简单介绍" class="headerlink" title="1.0 简单介绍"></a>1.0 简单介绍</h4><p><a href="https://github.com/cnpm/cnpm" target="_blank" rel="noopener">CNPM</a>是阿里的Node团队开发的一款NPM工具，由蚂蚁金服Node技术专家<a href="http://fengmk2.github.io/" target="_blank" rel="noopener">苏千</a>(<code>袁锋·Node技术专家</code>)和<a href="https://github.com/dead-horse" target="_blank" rel="noopener">死马</a>(<code>何翊宇·Node技术专家·koa.js和egg.js框架核心维护者</code>)主导，内核使用了自主研发的<a href="https://github.com/cnpm/npminstall" target="_blank" rel="noopener">npminstall</a>实现。CNPM依托于<a href="https://npm.taobao.org/" target="_blank" rel="noopener">淘宝NPM镜像</a>，在国内能够更快速的进行包和依赖的安装。</p>
<p>在<a href="https://npm.taobao.org/" target="_blank" rel="noopener">淘宝NPM镜像网站</a>上面有关于镜像的说明：<span style="color:#195">“这是一个完整 npmjs.org 镜像，你可以用此代替官方版本(只读)，同步频率目前为 10分钟 一次以保证尽量与官方服务同步”</span>。</p>
<p>也就是说，我们在管理和安装包的时候使用淘宝NPM镜像跟直接使用npm来进行安装的资源其实是相同的，因为国内网络环境的原因，我们直接使用淘宝NPM镜像来下载包速度会更快一些。</p>
<h4 id="2-0-基本使用"><a href="#2-0-基本使用" class="headerlink" title="2.0 基本使用"></a>2.0 基本使用</h4><div class="titleX"><strong>安装CNPM</strong></div>

<p><span class="spaceY spaceL" style="width:410px;">$ npm install -g cnpm </span> 全局安装CNPM<br><span class="spaceY spaceL" style="width:410px;">$ npm install -g cnpm - -registry=<a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></span> 全局安装CNPM并切换源</p>
<p><strong>注意</strong> 在命令行工具中执行上面命令的时候<code>--</code>中间没有空格。</p>
<p>在全局安装<code>CNPM</code>的时候如果切换了源，将会从<a href="https://registry.npm.taobao.org/" target="_blank" rel="noopener">Registry.npm.taobao.org</a>来安装模块。当安装的时候如果发现安装的模块还没有同步过来, 那么淘宝NPM会自动在后台进行同步, 并且会让你从官方NPM <a href="https://registry.npmjs.org/" target="_blank" rel="noopener">Registry.npmjs.org</a>进行安装. 当下次再安装这个模块的时候则直接从淘宝NPM安装。</p>
<div class="titleX"><strong>查看CNPM版本</strong></div><br><span class="spaceY" style="width:100px;">$ cnpm -v</span> 查看cnpm的版本信息<br><br><div class="titleX"><strong>包的安装</strong></div>

<p><code>CNPM</code>支持 <code>npm</code> 除了 <code>publish</code> 之外的所有命令，而且这些命令的使用方式和<code>npm</code>完全一致。</p>
<p><span class="spaceY spaceL" style="width:160px;">$ cnpm install xxx</span> 安装指定包到当前路径(<code>局部安装</code>)<br><span class="spaceY spaceL" style="width:160px;">$ cnpm install -g xxx</span> 安装指定包到全局包安装路径(<code>全局安装</code>)</p>
<p>这里简单列出上面几个命令的执行演示。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ npm install cnpm -g --registry=https://registry.npm.taobao.org</span><br><span class="line">npm WARN deprecated socks@1.1.10: If using 2.x branch, please upgrade to at least 2.1.6 </span><br><span class="line">to avoid a serious bug with socket data flow and an import issue introduced <span class="keyword">in</span> 2.1.0</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/cnpm -&gt; /usr/<span class="built_in">local</span>/lib/node_modules/cnpm/bin/cnpm</span><br><span class="line">+ cnpm@6.0.0</span><br><span class="line">added 12 packages, removed 8 packages and updated 58 packages <span class="keyword">in</span> 29.841s</span><br><span class="line"></span><br><span class="line">wendingding$ cnpm -v</span><br><span class="line">cnpm@6.0.0 (/usr/<span class="built_in">local</span>/lib/node_modules/cnpm/lib/parse_argv.js)</span><br><span class="line">npm@6.4.1 (/usr/<span class="built_in">local</span>/lib/node_modules/cnpm/node_modules/npm/lib/npm.js)</span><br><span class="line">node@8.9.3 (/usr/<span class="built_in">local</span>/bin/node)</span><br><span class="line">npminstall@3.16.0 (/usr/<span class="built_in">local</span>/lib/node_modules/cnpm/node_modules/npminstall/lib/index.js)</span><br><span class="line">prefix=/usr/<span class="built_in">local</span> </span><br><span class="line">darwin x64 17.4.0 </span><br><span class="line">registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">wendingding$ cnpm install jquery</span><br><span class="line">✔ Installed 1 packages</span><br><span class="line">✔ Run 0 scripts</span><br><span class="line">✔ All packages installed (1 packages installed from npm registry, </span><br><span class="line">used 624ms(network 622ms), speed 660.5kB/s, json 1(5.19kB), tarball 405.64kB)</span><br><span class="line"></span><br><span class="line">dingding:cnpm wendingding$ cnpm install -g jquery</span><br><span class="line">Downloading jquery to /usr/<span class="built_in">local</span>/lib/node_modules/jquery_tmp</span><br><span class="line">Copying /usr/<span class="built_in">local</span>/lib/node_modules/jquery_tmp/_jquery@3.3.1@jquery </span><br><span class="line">to /usr/<span class="built_in">local</span>/lib/node_modules/jquery</span><br><span class="line">Installing jquery<span class="string">'s dependencies </span></span><br><span class="line"><span class="string">to /usr/local/lib/node_modules/jquery/node_modules</span></span><br><span class="line"><span class="string">All packages installed (used 4ms(network 2ms), speed 0B/s, json 0(0B), tarball 0B)</span></span><br></pre></td></tr></table></figure></p>
<div class="titleX"><strong>同步模块</strong></div>

<p><span class="spaceY" style="width:200px;">$ cnpm sync xxx</span> 同步指定的模块。</p>
<p><code>CNPM</code>还支持同步模块，只需要使用<code>sync</code>命令即可，下面列出同步模块命令的执行细节。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ cnpm sync jquery</span><br><span class="line">Start sync [<span class="string">"jquery"</span>].</span><br><span class="line">sync jquery, PUT https://registry.npm.taobao.org/jquery/sync?publish=<span class="literal">false</span>&amp;nodeps=<span class="literal">false</span></span><br><span class="line">logurl: https://npm.taobao.org/sync/jquery<span class="comment">#logid=6065624</span></span><br><span class="line">[2018-11-27 10:16:56] </span><br><span class="line">    user: anonymous, sync jquery worker start, 1 concurrency, </span><br><span class="line">    nodeps: <span class="literal">false</span>, publish: <span class="literal">false</span>, syncUpstreamFirst: <span class="literal">false</span></span><br><span class="line">[2018-11-27 10:16:56] ----------------- Syncing jquery -------------------</span><br><span class="line">[2018-11-27 10:16:56] </span><br><span class="line">  [c<span class="comment">#0] [jquery] package(https://r.cnpmjs.org/jquery) status: 200,</span></span><br><span class="line">  dist-tags: &#123;<span class="string">"beta"</span>:<span class="string">"3.3.1"</span>,<span class="string">"latest"</span>:<span class="string">"3.3.1"</span>&#125;, </span><br><span class="line">  time.modified: 2018-01-20T17:27:17.000Z, unpublished: null, start...</span><br><span class="line">[2018-11-27 10:16:56]   [jquery] found 0 missing star users</span><br><span class="line">[2018-11-27 10:16:56]   [jquery] all versions are exists</span><br><span class="line">[2018-11-27 10:16:56]   [jquery] no versions need to deleted</span><br><span class="line">[2018-11-27 10:16:56]   [jquery] all 383 npm users exists</span><br><span class="line">[2018-11-27 10:16:56] [c<span class="comment">#0] [jquery] synced success, 0 versions: </span></span><br><span class="line">[2018-11-27 10:16:56] ----------------- Synced jquery success -------------------</span><br><span class="line">[2018-11-27 10:16:56] [<span class="keyword">done</span>] Sync jquery package finished, 1 success, 0 fail</span><br><span class="line">Success: [ jquery ]</span><br><span class="line">Fail: [  ]</span><br><span class="line">Sync all packages <span class="keyword">done</span>, successed: [<span class="string">"jquery"</span>], failed: []</span><br></pre></td></tr></table></figure></p>
<h4 id="3-0-番外篇"><a href="#3-0-番外篇" class="headerlink" title="3.0 番外篇"></a>3.0 番外篇</h4><p>我们使用CNPM的主要原因在于它在处理包的时候速度更快，很多人认为它的可取之处仅在于使用了国内的镜像，其实就算不用国内的镜像，CNPM的安装速度相对NPM也要更快一些。这是因为<strong>CNPM在处理的时候会把一些包缓存到<code>node_module/.npminstall</code>目录下，再以符号链接的方式将依赖目录链接到其对应的路径，这样做的好处是相同版本的包在安装的过程中实际上只有一份实体</strong>。</p>
<p><code>CNPM</code>截止本文最新的版本<code>6.0.0</code>,在目录结构和依赖支持方面它的4.2以及4.3+版本是比较重要的一个分水岭。在4.2的版本里，它的目录结构和<code>NPM 2</code>保持一致，是嵌入式的结构。后来因为<code>NPM 3</code>的原因导致很多前端以及部分Node依赖在NPM 2下无法正常工作。</p>
<p>因此，在4.3版本中CNMP为前端开发者加入了扁平化的支持，即后期的版本中除按照嵌入式目录结构安装依赖外，还会顺便将计算得到的依赖(<strong>依赖</strong> 、<strong>依赖的依赖</strong>或者是<strong>依赖的特定版本</strong>)存放一份到node_moudles目录下，不过这也导致<strong style="color:#f00">node_moubles下目录成群···</strong></p>
<hr>
<ul>
<li>Posted by 博客园·<a href="http://www.cnblogs.com/wendingding/" target="_blank" rel="noopener">文顶顶</a> | <a href="http://wendingding.com" target="_blank" rel="noopener">花田半亩</a></li>
<li>联系作者 简书·<a href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles" target="_blank" rel="noopener">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&amp;mod=TAB#place">Coder_文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://www.cnblogs.com/wendingding/" target="_blank" rel="noopener">文顶顶</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/11/25/Node系列-url/" class="prev">上一篇</a><a href="/2018/11/24/Node系列-npm/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2020 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计 376.8k (字)</p><div class="topDiv"><div><img src="https://raw.githubusercontent.com/flowerField/Source/master/Blog/M.png" style="width:100px;height:100px"> </div></div><!--p © #{year} #[a(href=config.url)!= config.author], powered by #[a(href=hexoURL, target="_blank") Hexo] and #[a(href=apolloURL, target="_blank") hexo-theme-apollo].--></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>