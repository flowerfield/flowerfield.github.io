<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 前端工程化系列[04]-Grunt构建工具的使用进阶 · 花田半亩</title><meta name="description" content="前端工程化系列[04]-Grunt构建工具的使用进阶 - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/白菜.jpeg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶的BLOG</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="http://weibo.com/p/1005053800117445/home?from=page_100505&amp;mod=TAB#place" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="http://blog.sina.com.cn/u/1910914290" target="_blank" class="nav-list-link">花田半亩</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">前端工程化系列[04]-Grunt构建工具的使用进阶</h1><div class="post-info">May 20, 2018<span class="post-count"></span> ✧ 字数统计:1,807(字) &nbsp;&nbsp; ♨︎ 阅读时长:7(分钟)</div><div class="post-content"><blockquote>
<p>在<a href="http://wendingding.com/2018/05/18/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%B3%BB%E5%88%97[02]%20Grunt%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" target="_blank" rel="external">前端工程化系列[02]-Grunt构建工具的基本使用</a>和<a href="http://wendingding.com/2018/05/20/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%B3%BB%E5%88%97[03]%20Grunt%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8%E8%BF%9B%E9%98%B6/" target="_blank" rel="external">前端工程化系列[03]-Grunt构建工具的运转机制</a>这两篇文章中，我们对Grunt以及Grunt插件的使用已经有了初步的认识，并探讨了Grunt的主要组件以及它的运转机制，这篇文章是Grunt使用的进阶教程，主要输出以下内容：</p>
<p>❏ &nbsp;<span style="color:#f25">Grunt自定义任务</span><br>❏ &nbsp;<span style="color:#f25">Grunt任务的描述和依赖</span><br>❏ &nbsp;<span style="color:#f25">Grunt自动化构建和监听</span><br>❏ &nbsp;<span style="color:#f25">Grunt配置管理进阶教程</span><br>❏ &nbsp;<span style="color:#f25">Grunt自定义插件的创建和发布</span><br>❏ &nbsp;<span style="color:#f25">使用Grunt构建工具的开源项目Task分析</span></p>
</blockquote>
<h3 id="3-1-Grunt自定义任务"><a href="#3-1-Grunt自定义任务" class="headerlink" title="3.1 Grunt自定义任务"></a>3.1 Grunt自定义任务</h3><p>在使用Grunt的时候，可以先到Grunt官网的插件列表搜索是否有适合自己项目的Grunt插件，如果有那么建议直接使用，如果没有那么开发者可以尝试自定义任务或者是自己创建对应的插件。Grunt的插件其实就是一些封装好的任务(Task)，没有什么稀奇的，Grunt支持自定义任务，而且方式非常简单。</p>
<p>如果我们需要定义一个任务，向控制台里输出字符串信息，那么在package.json文件、Gruntfile文件已经创建且grunt本地依赖已安装的前提下，如下编辑Gruntfile文件即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//包装函数</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//(1)自定义任务(一)</span></div><div class="line">    <span class="comment">//向控制台输出:hello 文顶顶</span></div><div class="line">    <span class="comment">//第一个参数:任务的名称(Task)</span></div><div class="line">    <span class="comment">//第二个参数:具体的任务内容</span></div><div class="line">    grunt.registerTask(<span class="string">"hello"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        grunt.log.writeln(<span class="string">"hello 文顶顶"</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">//(2)自定义任务(二)</span></div><div class="line">    grunt.registerTask(<span class="string">"football"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        grunt.log.writeln(<span class="string">"皇家马德里: how are you!"</span>);</div><div class="line">        grunt.log.writeln(<span class="string">"尤文图斯: how old are you！"</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>终端输入命令执行任务，可以单个执行，也可以一起执行，下面给出具体执行情况<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">wendingding:02-Grunt_Test wendingding$ grunt hello</div><div class="line">Running "hello" task</div><div class="line">hello 文顶顶</div><div class="line"></div><div class="line">Done.</div><div class="line">wendingding:02-Grunt_Test wendingding$ grunt football</div><div class="line">Running "football" task</div><div class="line">皇家马德里: how are you!</div><div class="line">尤文图斯: how old are you！</div><div class="line"></div><div class="line">Done.</div><div class="line">wendingding:02-Grunt_Test wendingding$ grunt hello football</div><div class="line">Running "hello" task</div><div class="line">hello 文顶顶</div><div class="line"></div><div class="line">Running "football" task</div><div class="line">皇家马德里: how are you!</div><div class="line">尤文图斯: how old are you！</div><div class="line"></div><div class="line">Done.</div></pre></td></tr></table></figure></p>
<p>通过上面的代码我们可以看到，<span style="color:red">自定义任务非常简单，只需要调用grunt对象的registerTask方法即可，其中第一个参数是Task的名称，第二个参数是回调函数用来存放具体的任务（比如这里是打印输出）。</span></p>
<div class="tip">在自定义任务中，我们用到了grunt.log.writeln函数，这是Grunt提供的众多内置方法之一，作用是向控制台输出消息并换行。同类型的方法还有grunt.log.error()、grunt.log.subhead()等方法，大家可以到<a href="https://gruntjs.com/api/grunt.log" target="_blank" rel="external">官网API文档</a>自行查看。</div>

<p>Grunt项目在具体使用的时候，通常是自定义Task + Grunt插件相结合的形式，我们来看下面这段代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//包装函数</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//(1)自定义任务(一) 任务名称 hello</span></div><div class="line">    grunt.registerTask(<span class="string">"hello"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        grunt.log.writeln(<span class="string">"hello 文顶顶"</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">//(2)自定义任务(二) 任务名称 football</span></div><div class="line">    grunt.registerTask(<span class="string">"football"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        grunt.log.writeln(<span class="string">"皇家马德里: how are you!"</span>);</div><div class="line">        grunt.log.writeln(<span class="string">"尤文图斯: how old are you！"</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//(2) 插件的处理</span></div><div class="line">    <span class="comment">//使用步骤:</span></div><div class="line">    <span class="comment">//[1] 先把对应的插件下载和安装到本地的项目中 $ npm install grunt-contrib-concat --save-dev</span></div><div class="line">    <span class="comment">//[2] 对插件(任务)进行配置 grunt.initConfig</span></div><div class="line">    <span class="comment">//[3] 加载对应的插件 loadNpmTasks</span></div><div class="line">    <span class="comment">//[4] 注册任务      grunt.registerTask</span></div><div class="line">    <span class="comment">//[5] 通过grunt命令执行任务</span></div><div class="line">    <span class="comment">//配置插件相关信息</span></div><div class="line">    grunt.initConfig(&#123;</div><div class="line">        <span class="string">"concat"</span>:&#123;</div><div class="line">            <span class="string">"dist"</span>:&#123;</div><div class="line">                <span class="string">"src"</span>:[<span class="string">"src/demo_one.js"</span>,<span class="string">"src/demo_two.js"</span>,<span class="string">"src/demo_three.js"</span>],</div><div class="line">                <span class="string">"dest"</span>:<span class="string">"dist/index.js"</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">//加载插件</span></div><div class="line">    grunt.loadNpmTasks(<span class="string">"grunt-contrib-concat"</span>);</div><div class="line"></div><div class="line">    <span class="comment">//注册任务（一）：把hello \ football \ concat 这三个Task注册为default的Task</span></div><div class="line">    <span class="comment">//当执行$ grunt 或者是$ grunt default的时候，会顺序执行者三个任务！</span></div><div class="line">    grunt.registerTask(<span class="string">"default"</span>,[<span class="string">"hello"</span>,<span class="string">"football"</span>,<span class="string">"concat"</span>]);</div><div class="line">    <span class="comment">//注册任务(二)</span></div><div class="line">    grunt.registerTask(<span class="string">"customTask"</span>,[<span class="string">"hello"</span>,<span class="string">"football"</span>]);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>对于上面的Gruntfile文件，如果在终端输入<code>$ grunt</code>或者<code>$ grunt default</code> 命令则依次执行hello football和concat三个任务，输入<code>$ grunt customTask</code>则一次执行hello football 自定义任务。</p>
<h3 id="3-2-任务描述和依赖"><a href="#3-2-任务描述和依赖" class="headerlink" title="3.2 任务描述和依赖"></a>3.2 任务描述和依赖</h3><p><strong>设置任务描述</strong></p>
<p>随着项目复杂性的增加，Grunt任务也会越来越多，而任务(Task)的可用性、用途以及调用方法可能会变得难以追踪。所幸，我们可以通过给任务设定相应的描述信息来解决这些问题。</p>
<p>要给任务设置描述信息非常简单，只需要在调用registerTask方法的时候多传递一个参数即可（作为第二个参数传递），我们可以把一个具体的字符串描述信息作为函数的参数传递。</p>
<p>这里，我们修改上面示例代码中football任务部分的代码，并任务设置描述信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">grunt.registerTask(<span class="string">"football"</span>,<span class="string">"17-18赛季 欧冠八分之一决赛抽签场景"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        grunt.log.writeln(<span class="string">"皇家马德里: how are you!"</span>);</div><div class="line">        grunt.log.writeln(<span class="string">"尤文图斯: how old are you！"</span>);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>此时，在终端中输入<code>$ grunt --help</code>命令就能够看到当前Grunt项目中可用的Task，以及相应的描述信息了，关键信息如下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Available tasks</div><div class="line">         hello  Custom task.</div><div class="line">      football  17-18赛季 欧冠八分之一决赛抽签场景</div><div class="line">        concat  Concatenate files. *</div><div class="line">       default  Alias for "hello", "football", "concat" tasks.</div><div class="line">    customTask  Alias for "hello", "football" tasks.</div></pre></td></tr></table></figure>
<p><strong>任务依赖</strong></p>
<p>在复杂的Grunt工作流程中，很多任务之间往往存在依赖关系，比如js代码的语法检查和压缩这两个任务，压缩任务需要依赖于语法检查任务，它们在执行的时候存在一定的先后关系，这种情况我们称之为任务依赖。</p>
<p>我们可以在注册任务的时候，刻意指定这种依赖关系，他们更多的是以一种特定的先后顺序执行。<span style="color:red">如果是自定义任务，也可以通过grunt.task.requires()方法来设定这种任务间的依赖关系。</span><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</div><div class="line">    <span class="comment">//注册两个自定义任务</span></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">    * 第一个参数:Task的名称</span></div><div class="line"><span class="comment">    * 第二个参数:任务的描述信息</span></div><div class="line"><span class="comment">    * */</span></div><div class="line">    grunt.registerTask(<span class="string">"hi"</span>,<span class="string">"描述信息:这是一个打招呼的任务"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        grunt.log.ok(<span class="string">"hi 文顶顶"</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    grunt.registerTask(<span class="string">"hello"</span>,<span class="string">"任务的描述次信息:这是一个简单问候任务"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">//设置任务依赖：表明当前的任务在执行的时候需要依赖于另外一个任务</span></div><div class="line">        <span class="comment">//必须先执行hi这个任务,才能执行hello这个任务</span></div><div class="line">        grunt.task.requires(<span class="string">"hi"</span>);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Nice to meet you!"</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>上面的代码中定义了hi和hello两个任务，其中hello这个Task需要依赖于hi的执行，如果直接执行hello，那么会打印任务依赖的提示信息，具体的执行情况如下。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">wendingding:05-Grunt项目任务的描述和依赖 wendingding$ grunt hello</div><div class="line">Running "hello" task</div><div class="line">Warning: Required task "hi" must be run first. Use --force to continue.</div><div class="line"></div><div class="line">Aborted due to warnings.</div><div class="line">wendingding:05-Grunt项目任务的描述和依赖 wendingding$ grunt hi hello</div><div class="line">Running "hi" task</div><div class="line">&gt;&gt; hi 文顶顶</div><div class="line"></div><div class="line">Running "hello" task</div><div class="line">Nice to meet you!</div><div class="line">Done.</div></pre></td></tr></table></figure></p>
<hr>
<ul>
<li>Posted by 博客园·<a href="http://www.cnblogs.com/wendingding/" target="_blank" rel="external">文顶顶</a> ~ <a href="http://wendingding.com" target="_blank" rel="external">文顶顶的个人博客_花田半亩</a></li>
<li>联系作者 简书·<a href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles" target="_blank" rel="external">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&amp;mod=TAB#place">文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://www.cnblogs.com/wendingding/" target="_blank" rel="external">文顶顶</a></li>
</ul>
<p><img src="https://github.com/flowerField/Source/blob/master/Blog/zanshang.jpeg?raw=true" width="180" height="180"></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/05/20/前端工程化系列[03] Grunt构建工具的运转机制/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计95.7k(字)</p><!--p © #{year} #[a(href=config.url)!= config.author], powered by #[a(href=hexoURL, target="_blank") Hexo] and #[a(href=apolloURL, target="_blank") hexo-theme-apollo].--></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>