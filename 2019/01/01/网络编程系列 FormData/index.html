<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 网络编程系列 FormData · 花田半亩</title><meta name="description" content="网络编程系列 FormData - 文顶顶"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.jpeg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://weibo.com/u/3800117445/atom.xml" title="花田半亩"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/鲸鱼.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文顶顶的BLOG</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="https://www.cnblogs.com/wendingding/" target="_blank" class="nav-list-link">博客园</a></li><li class="nav-list-item"><a href="http://weibo.com/p/1005053800117445/home?from=page_100505&amp;mod=TAB#place" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="http://blog.sina.com.cn/u/1910914290" target="_blank" class="nav-list-link">花田半亩</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">网络编程系列 FormData</h1><div class="post-info">Jan 1, 2019<span class="post-count"></span> ✧ 字数统计:2,502(字) &nbsp;&nbsp; ♨︎ 阅读时长:12(分钟)</div><div class="post-content"><p></p><p class="titleX"><strong>FormData 简单介绍</strong></p><a href="">FormData</a>是<code>Ajax 2.0</code>-<a href="https://dvcs.w3.org/hg/xhr/raw-file/tip/Overview.html" target="_blank" rel="noopener">XMLHttpRequest Level 2</a> 提供的一个接口对象，可以使用该对象来模拟和处理表单并方便的进行<strong>文件上传</strong>操作。<p></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.dir(FormData)</span><br><span class="line">ƒ FormData()</span><br><span class="line">    <span class="built_in">arguments</span>: <span class="literal">null</span></span><br><span class="line">    caller: <span class="literal">null</span></span><br><span class="line">    length: <span class="number">0</span></span><br><span class="line">    name: <span class="string">"FormData"</span></span><br><span class="line">    prototype: FormData</span><br><span class="line">        append: ƒ append()</span><br><span class="line">        <span class="keyword">delete</span>: ƒ <span class="keyword">delete</span>()</span><br><span class="line">        entries: ƒ entries()</span><br><span class="line">        forEach: ƒ forEach()</span><br><span class="line">        get: ƒ ()</span><br><span class="line">        getAll: ƒ getAll()</span><br><span class="line">        has: ƒ has()</span><br><span class="line">        keys: ƒ keys()</span><br><span class="line">        set: ƒ ()</span><br><span class="line">        values: ƒ values()</span><br><span class="line">        <span class="keyword">constructor</span>: ƒ FormData()</span><br><span class="line">        Symbol(Symbol.iterator): ƒ entries()</span><br><span class="line">        Symbol(Symbol.toStringTag): "FormData"</span><br><span class="line">        __proto__: Object</span><br><span class="line">    __proto__: ƒ ()</span><br><span class="line">    [[Scopes]]: Scopes[0]</span><br></pre></td></tr></table></figure>
<p>通过打印并查看formData的结构，可以发现该接口对象本身非常简单。在<a href="">FormData</a>构造函数原型对象上只有<code>append</code>、<code>forEach</code>、<code>keys</code>等少数方法。</p>
<div class="titleX"><strong>FormData的主要用处</strong></div>

<blockquote>
<p>❐ 网络请求中模拟和处理表单数据<br>❐ 网络请求中用来异步的上传文件</p>
</blockquote>
<div class="titleX"><strong>FormData实例的创建</strong></div>

<p><span style="color:#888">◆</span> <strong><code>new FormData (form? : HTMLFormElement)</code></strong></p>
<p>在使用FormData构造函数创建实例对象的时候，可以传递一个HTML表单元素，该表单元素允许是任何形式的表单控件，包括文件输入框、复选框等。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"formTest"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"请输入用户名"</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"wendingding"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"请输入密码"</span> <span class="attr">name</span>=<span class="string">"pass"</span> <span class="attr">value</span>=<span class="string">"123456789"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//列出创建formData实例对象的几种方式</span></span><br><span class="line"><span class="comment">//001 通过构造函数创建不传递任务参数</span></span><br><span class="line"><span class="keyword">var</span> formData1 = <span class="keyword">new</span> FormData();   <span class="comment">//空的实例对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//通过调用对象的方法来设置数据(模拟表单)</span></span><br><span class="line"><span class="comment">//设置数据</span></span><br><span class="line">formData1.set(<span class="string">"name"</span>,<span class="string">"文顶顶"</span>);</span><br><span class="line">formData1.set(<span class="string">"email"</span>,<span class="string">"wendingding_ios@126.com"</span>);</span><br><span class="line">formData1.set(<span class="string">"friends"</span>,<span class="string">"熊大"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置数据(追加)</span></span><br><span class="line">formData1.append(<span class="string">"friends"</span>,<span class="string">"光头强"</span>);</span><br><span class="line">formData1.append(<span class="string">"friends"</span>,<span class="string">"萝卜头"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看实例数据</span></span><br><span class="line">formData1.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value,key</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key,value);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"----------------------------------"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//002 获取表单标签传递给FormData构造函数</span></span><br><span class="line"><span class="keyword">var</span> formData2 = <span class="keyword">new</span> FormData(<span class="built_in">document</span>.forms.namedItem(<span class="string">"formTest"</span>))</span><br><span class="line">formData2.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value,key</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key,value);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<div class="tip"><strong>注意</strong> 表单标签必须要设置name属性节点才能获取其数据</div>

<p><strong>说明</strong> 在上面的示例代码中介绍了两种创建(获取)formData实例对象的方式，可以<span style="color:#f33">先创建一个空的实例对象也可以直接通过页面中的表单标签来进行初始化处理</span>。</p>
<p>当formData数据装填好之后，可以直接通过ajax方法提交到服务器端，下面给出上面代码的执行结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name 文顶顶</span><br><span class="line">email wendingding_ios@126.com</span><br><span class="line">friends 熊大</span><br><span class="line">friends 光头强</span><br><span class="line">friends 萝卜头</span><br><span class="line">----------------------------------</span><br><span class="line">user wendingding</span><br><span class="line">pass 123456789</span><br></pre></td></tr></table></figure>
<div class="titleX"><strong>FormData的主要方法</strong></div>

<p><img src="https://github.com/flowerField/Source/blob/master/Blog/formData.png?raw=true"></p>
<p>如上图所示，FormData构造函数的原型对象上面定义了一堆方法。这些方法使用方式都很简单，接下来我们通过代码的方式简单介绍他们。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//01 创建空的formData实例对象</span></span><br><span class="line">   <span class="keyword">var</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line"></span><br><span class="line">   <span class="comment">//02 设置数据(添加)</span></span><br><span class="line">   data.set(<span class="string">"age"</span>,<span class="number">18</span>);</span><br><span class="line">   data.set(<span class="string">"name"</span>,<span class="string">"LiuY"</span>);</span><br><span class="line">   data.set(<span class="string">"type"</span>,<span class="string">"法师"</span>);</span><br><span class="line">   data.set(<span class="string">"address"</span>,<span class="string">"泉水中心"</span>);</span><br><span class="line">   <span class="comment">//03 设置数据(修改和删除)</span></span><br><span class="line">   data.set(<span class="string">"name"</span>,<span class="string">"MiTaoer"</span>);</span><br><span class="line">   data.delete(<span class="string">"address"</span>);</span><br><span class="line">   <span class="comment">//04 设置数据(追加)</span></span><br><span class="line">   data.append(<span class="string">"type"</span>,<span class="string">"战士"</span>);</span><br><span class="line">   data.append(<span class="string">"type"</span>,<span class="string">"辅助"</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//05 读取数据(指定key-one)</span></span><br><span class="line">   <span class="built_in">console</span>.log(data.get(<span class="string">"name"</span>));          <span class="comment">//MiTaoer</span></span><br><span class="line">   <span class="built_in">console</span>.log(data.get(<span class="string">"type"</span>));          <span class="comment">//法师</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//06 读取数据(指定key-All)</span></span><br><span class="line">   <span class="built_in">console</span>.log(data.getAll(<span class="string">"type"</span>));       <span class="comment">//["法师", "战士", "辅助"]</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">//07 检查是否拥有指定的key</span></span><br><span class="line">   <span class="built_in">console</span>.log(data.has(<span class="string">"age"</span>));           <span class="comment">//true</span></span><br><span class="line">   <span class="built_in">console</span>.log(data.has(<span class="string">"email"</span>));         <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//08 迭代器的基本使用(keys)</span></span><br><span class="line">   <span class="keyword">var</span> keyIterator = data.keys()      <span class="comment">//获取迭代器对象</span></span><br><span class="line">   <span class="built_in">console</span>.log(keyIterator.next());   <span class="comment">//&#123;done: false, value: "age"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(keyIterator.next());   <span class="comment">//&#123;done: false, value: "name"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(keyIterator.next());   <span class="comment">//&#123;done: false, value: "type"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(keyIterator.next());   <span class="comment">//&#123;done: false, value: "type"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(keyIterator.next());   <span class="comment">//&#123;done: false, value: "type"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(keyIterator.next());   <span class="comment">//&#123;done: true, value: undefined&#125;</span></span><br><span class="line">   </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"___________________"</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//09 迭代器的基本使用(values)</span></span><br><span class="line">   <span class="keyword">var</span> valueIterator = data.values();  <span class="comment">//获取迭代器对象</span></span><br><span class="line">   <span class="built_in">console</span>.log(valueIterator.next());  <span class="comment">//&#123;done: false, value: "18"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(valueIterator.next());  <span class="comment">//&#123;done: false, value: "MiTaoer"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(valueIterator.next());  <span class="comment">//&#123;done: false, value: "法师"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(valueIterator.next());  <span class="comment">//&#123;done: false, value: "战士"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(valueIterator.next());  <span class="comment">//&#123;done: false, value: "辅助"&#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(valueIterator.next());  <span class="comment">//&#123;done: true, value: undefined&#125;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//10 迭代器的基本使用(entries)</span></span><br><span class="line">   <span class="built_in">console</span>.log(data.entries().next());     <span class="comment">//&#123;done: false, value: ["age", "18"]&#125;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//11 formData对象的遍历</span></span><br><span class="line">   data.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value,key</span>)</span>&#123;</span><br><span class="line">       <span class="comment">//输出结果</span></span><br><span class="line">       <span class="comment">// age 18</span></span><br><span class="line">       <span class="comment">// name MiTaoer</span></span><br><span class="line">       <span class="comment">// type 法师</span></span><br><span class="line">       <span class="comment">// type 战士</span></span><br><span class="line">       <span class="comment">// type 辅助</span></span><br><span class="line">       <span class="built_in">console</span>.log(key,value);</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>
<p><strong>代码说明</strong></p>
<p><a href="">formData对象</a>的这些方法其实不用进行过多的赘述，上面的代码和说明简单易懂。总体上来说，它提供了一整套的操作数据的方法囊括了添加(set)、修改、查询和删除等操作，<code>append</code>方法和set方法的不同之处在于它不会覆盖而是以数组push的方式来处理同名的数据。</p>
<p><a href="">formData对象</a>的<code>keys()</code>、<code>values()</code>和<code>entries()</code>方法使用类似，调用后将得到一个<code>Iterator类型</code>的迭代器对象，该对象能够能够调用<code>next()</code>方法来进行迭代操作，打印结果中的<code>done</code>使用布尔类型的值来进行标记，如果迭代结束那么值为<strong>true</strong>。</p>
<p><a href="">formData对象</a>的<code>forEach()</code>接收一个回调函数参数，其中第一个参数为当前遍历数据的<code>value</code>值，第二个参数为<code>key</code>(同数组的forEach方法一致)。如果是Ajax发送GET请求，需要通过<a href="">formData对象</a>的方式来提交表单数据，那么可以借助该方法来拼接查询字符串。</p>
<p></p><p class="titleX"><strong>FormData的典型用法</strong></p>这里给定如下的表单数据，然后介绍如何使用FormData来处理表单数据发送GET和POST请求。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"formTest"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">placeholder</span>=<span class="string">"请输入用户名"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">placeholder</span>=<span class="string">"请输入邮箱"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pass"</span> <span class="attr">placeholder</span>=<span class="string">"请输入密码"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"check"</span>&gt;</span> 是否勾选<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>提交表单数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p>
<div style="background:#195;color:#fff;width:120px;text-align:center"><strong>GET请求</strong></div>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//01 获取页面中的btn标签</span></span><br><span class="line"><span class="keyword">var</span> oBtn = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"button"</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//02 给按钮标签添加点击事件</span></span><br><span class="line">oBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//03 使用Ajax发送GET请求</span></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(<span class="string">"GET"</span>,<span class="string">"http://127.0.0.1:3000?"</span>+getData(),<span class="literal">true</span>);</span><br><span class="line">    xhr.send();</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt;=<span class="number">300</span> || xhr.status == <span class="number">304</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"请求成功"</span>+xhr.responseText);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"请求失败"</span>+xhr.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取页面中的表单数据并处理为查询字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = [];</span><br><span class="line">    <span class="keyword">var</span> data = <span class="keyword">new</span> FormData(<span class="built_in">document</span>.forms.namedItem(<span class="string">"formTest"</span>));</span><br><span class="line">    data.append(<span class="string">"age"</span>,<span class="number">18</span>);</span><br><span class="line">    data.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value,key</span>)</span>&#123;</span><br><span class="line">        arr.push(key+<span class="string">"="</span>+value);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> arr.join(<span class="string">"&amp;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面的代码示例可以发现，使用formData来处理表单数据发送GET请求并没有什么优势，也需要通过循环来处理然后把键值对转换为查询字符串的形式拼接在<code>URL字符串</code>的后面。</p>
<div style="background:#195;color:#fff;width:120px;text-align:center"><strong>POST请求</strong></div>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//01 获取页面中的btn标签</span></span><br><span class="line"><span class="keyword">var</span> oBtn = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"button"</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//02 给按钮标签添加点击事件</span></span><br><span class="line">oBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//03 处理参数</span></span><br><span class="line">    <span class="comment">//方式(1) 模拟表单数据</span></span><br><span class="line">    <span class="keyword">var</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line">    data.set(<span class="string">"name"</span>,<span class="string">"文顶顶"</span>);</span><br><span class="line">    data.set(<span class="string">"color"</span>,<span class="string">"red"</span>);</span><br><span class="line">    data.set(<span class="string">"email"</span>,<span class="string">"yangyong@520it.com"</span>);</span><br><span class="line">    data.append(<span class="string">"email"</span>,<span class="string">"wendingding_ios@126.com"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方式(2) 获取表单数据</span></span><br><span class="line">    <span class="comment">//var data = new FormData(document.forms.namedItem("formTest"));</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//04 使用Ajax发送GET请求</span></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(<span class="string">"POST"</span>,<span class="string">"http://127.0.0.1:3000"</span>,<span class="literal">true</span>);</span><br><span class="line">    xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>);</span><br><span class="line">    xhr.send(data);</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt;=<span class="number">300</span> || xhr.status == <span class="number">304</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"请求成功"</span>+xhr.responseText);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"请求失败"</span>+xhr.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果发送的是POST请求，那么提交表单数据需要通过<code>setRequestHeader</code>方法来设置<code>&#39;Content-Type&#39;, &#39;application/x-www-form-urlencoded&#39;</code>，而formData数据直接作为<code>send</code>方法的参数来进行提交即可。<code>POST</code>请求通过formData提交给服务器端的数据，如果是Node服务器端则很难处理(同文件一样)。<a href="">formData</a>最主要的用途其实是用来异步的进行文件上传。</p>
<p><div style="background:#195;color:#fff;width:200px;text-align:center"><strong>POST请求进行文件上传</strong></div><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">id</span>=<span class="string">"userID"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file-name"</span> <span class="attr">id</span>=<span class="string">"fileID"</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>上传文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//01 获取页面中的btn标签</span></span><br><span class="line"><span class="keyword">var</span> oBtn    = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"button"</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> oUser   = <span class="built_in">document</span>.getElementById(<span class="string">"userID"</span>);</span><br><span class="line"><span class="keyword">var</span> oFileID = <span class="built_in">document</span>.getElementById(<span class="string">"fileID"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//02 给按钮标签添加点击事件</span></span><br><span class="line">oBtn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//03 获取表单中的文件内容</span></span><br><span class="line">    <span class="keyword">var</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line">    data.set(<span class="string">"user"</span>,oUser.value);</span><br><span class="line">    <span class="built_in">Array</span>.from(oFileID.files).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">file</span>)</span>&#123;</span><br><span class="line">        data.append(<span class="string">"fileName"</span>,file);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//04 使用Ajax发送GET请求</span></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(<span class="string">"POST"</span>,<span class="string">"http://127.0.0.1:5000/api"</span>,<span class="literal">true</span>);</span><br><span class="line">    xhr.send(data);</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt;=<span class="number">300</span> || xhr.status == <span class="number">304</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"请求成功"</span>+xhr.responseText);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"请求失败"</span>+xhr.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里顺便贴出测试文件上传写的Node代码以及文件上传后的监听结果。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备注：node文件名称为uploadServer.js</span></span><br><span class="line"><span class="comment">//01 导入模块(需先通过npm来进行安装)</span></span><br><span class="line"><span class="keyword">var</span> express   =   <span class="built_in">require</span>(<span class="string">'express'</span>);     </span><br><span class="line"><span class="keyword">var</span> multer    =   <span class="built_in">require</span>(<span class="string">'multer'</span>);         </span><br><span class="line"><span class="keyword">var</span> body      =   <span class="built_in">require</span>(<span class="string">'body-parser'</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line">app.listen(<span class="number">5000</span>);</span><br><span class="line">app.use(body.urlencoded( &#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125; ));</span><br><span class="line">app.use(multer( &#123; <span class="attr">dest</span>: <span class="string">'./upload/'</span> &#125; ).any());</span><br><span class="line"></span><br><span class="line"><span class="comment">//02 监听网络请求并设置打印接收到的参数信息</span></span><br><span class="line">app.post(<span class="string">'/api'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>);</span><br><span class="line">    res.send(<span class="string">"Nice ! 上传成功 ~ "</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(req.body);      <span class="comment">//普通POST数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.files);     <span class="comment">//文件POST数据</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">app.use(express.static(<span class="string">'./html/'</span>));</span><br></pre></td></tr></table></figure></p>
<p><strong>代码说明</strong> 需要先通过<code>npm install express multer body-parser</code>命令在当前路径中安装对应的模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">wendingding$ node uploadServer.js </span><br><span class="line">&#123; user: <span class="string">'wen'</span> &#125;</span><br><span class="line">[ &#123; fieldname: <span class="string">'fileName'</span>,</span><br><span class="line">    originalname: <span class="string">'formData.png'</span>,</span><br><span class="line">    encoding: <span class="string">'7bit'</span>,</span><br><span class="line">    mimetype: <span class="string">'image/png'</span>,</span><br><span class="line">    destination: <span class="string">'./upload/'</span>,</span><br><span class="line">    filename: <span class="string">'f416da3b522ece9e4cc2eccd5b7a62e8'</span>,</span><br><span class="line">    path: <span class="string">'upload/f416da3b522ece9e4cc2eccd5b7a62e8'</span>,</span><br><span class="line">    size: 50002 &#125;,</span><br><span class="line">  &#123; fieldname: <span class="string">'fileName'</span>,</span><br><span class="line">    originalname: <span class="string">'Snip20190107_1.png'</span>,</span><br><span class="line">    encoding: <span class="string">'7bit'</span>,</span><br><span class="line">    mimetype: <span class="string">'image/png'</span>,</span><br><span class="line">    destination: <span class="string">'./upload/'</span>,</span><br><span class="line">    filename: <span class="string">'2a2dd60e217b9cc08f2cc0048a1d27ab'</span>,</span><br><span class="line">    path: <span class="string">'upload/2a2dd60e217b9cc08f2cc0048a1d27ab'</span>,</span><br><span class="line">    size: 1309894 &#125; ]</span><br></pre></td></tr></table></figure>
<ul>
<li>Posted by 博客园·<a href="http://www.cnblogs.com/wendingding/" target="_blank" rel="noopener">文顶顶</a> | <a href="http://wendingding.com" target="_blank" rel="noopener">花田半亩</a></li>
<li>联系作者 简书·<a href="http://www.jianshu.com/users/c5703017b9f5/latest_articleshttp://www.jianshu.com/users/c5703017b9f5/latest_articles" target="_blank" rel="noopener">文顶顶</a> 新浪微博·<a href="http://weibo.com/p/1005053800117445/home?from=page_100505&amp;mod=TAB#place">Coder_文顶顶</a></li>
<li>原创文章，版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://www.cnblogs.com/wendingding/" target="_blank" rel="noopener">文顶顶</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2019/01/01/javaScript系列 [10]-Canvas绘图(基础)/" class="prev">上一篇</a><a href="/2019/01/01/江湖夜雨系列 请召文/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2019 <a href="https://weibo.com/u/3800117445">文顶顶</a> &nbsp;☁ 全站字数统计 306.3k (字)</p><div class="topDiv"><div><img src="https://raw.githubusercontent.com/flowerField/Source/master/Blog/M.png" style="width:100px;height:100px"> </div></div><!--p © #{year} #[a(href=config.url)!= config.author], powered by #[a(href=hexoURL, target="_blank") Hexo] and #[a(href=apolloURL, target="_blank") hexo-theme-apollo].--></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>